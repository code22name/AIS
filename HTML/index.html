<!doctype html>
<title>AIS-catcher</title>
<meta name=viewport content="width=device-width,initial-scale=1">
<script src=https://kit.fontawesome.com/296bfd8db6.js crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/chart.js></script>
<script src=https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation/dist/chartjs-plugin-annotation.min.js></script>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" integrity="sha256-kLaT2GOSpHechhsozzB+flnD+zUyjE2LlfWPgU04xyI=" crossorigin="" />

<script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js" integrity="sha256-WBkoXOwTeyKclOHuWtc+i2uENFpDZ9YPdf5Hf+D7ewM=" crossorigin=""></script>

<style>
    body,
    html {
        height: 100%;
        width: 100%;
        margin: 0;
        font-family: Arial;
        display: flex;
        flex-direction: column;
        justify-content: stretch;
        -webkit-user-select: none;
        -ms-user-select: none;
        user-select: none
    }

    .header {
        background: #12a5ed;
        color: #fff;
        flex: 0 0 50px;
        justify-content: stretch;
        padding: 20px 0 0 20px;
        display: flex;
        font-size: 25px;
    }

    .header-pulse {
        font-size: 25px;
        flex: 0 0 40px;
        color: white;
    }

    .menubar {
        flex: 0 0 36px;
        display: flex;
        justify-content: center;
        background: #fff;
        color: dimgray;
        text-align: center;
        align-items: stretch;
        padding: 14px 0 0;
        background-color: inherit
    }

    .menu-item {
        flex: 0 1 200px;
        border: none;
        background: inherit;
        cursor: pointer
    }

        .menu-item.active {
            border-bottom: solid;
            border-color: #12a5ed;
            color: #12a5ed;
            border-width: 4px
        }

    .mainspace-container {
        flex: 1 0 0;
        overflow: auto;
        background: #f5f7fa;
        border-top: solid;
        border-color: lightgrey;
        border-width: 4px;
        display: flex;
        flex-direction: column;
        justify-content: stretch;
    }

    .mainspace {
        background: #fff;
        margin: 20px;
        flex: 1;
        border: 1;
    }

    .bottombar {
        flex: 0 0 15px;
        background: #0b1033
    }

    .summarytab {
        padding: 20px;
        overflow: auto;
    }

    .summary-seperator {
        flex: 0 0;
        width: 0;
        border-left: solid;
        border-color: lightgrey
    }

    .summaryrow {
        display: flex;
    }

    .summary-box-left {
        flex: 1 1 150px;
        text-align: right;
        color: dimgray;
        padding-right: 20px;
        display: flex;
        flex-direction: column
    }

    .summary-box-right {
        flex: 1 0 150px;
        text-align: left;
        color: dimgray;
        padding-left: 20px;
        font-weight: 700;
        overflow-x: auto
    }

    .summary-section {
        height: 20px
    }

    .summary-text {
        padding: 6px
    }

    .popup-text {
        padding: 2px
    }

    .tabcontent {
    }

    .graphtab {
        padding: 20px;
        overflow: auto;
    }

    .graph_plot {
        margin: 10px;
        padding: 15px;
        overflow: auto;
        background-color: #f2f8ff;
        float: left;
    }

    .graph_header {
        padding-top: 20px;
        padding-bottom: 20px;
        color: dimgrey;
        margin: 0 auto;
        text-align: center;
        font-size: 1.0em;
        font-weight: bold;
    }

    .graph {
        min-width: 440px;
        max-width: 440px;
        min-height: 220px;
        max-height: 220px;
        margin: 0 auto;
        overflow: auto;
    }

    .tablesection {
        overflow: auto;
        padding: 10px;
        font-size: .8em;
        display: flex;
        height: 100%;
        overflow: auto;
    }

    table {
        border-collapse: collapse;
        border: solid;
        height: 100%;
        width: 100%;
        max-width: 1500px;
        border-color: darkgrey;
        margin: 0 auto
    }

        table thead {
            color: #fff;
            background-color: #0b1033;
            font-size: 1em;
            border-bottom: solid;
            border-color: darkgrey;
        }

            table thead th,
            td {
                padding: 20px;
                text-align: left;
                border-collapse: collapse
            }

        table th,
        td {
            padding: 5px;
            padding-left: 20px;
            text-align: left;
            border-collapse: collapse
        }

        table tbody th,
        td {
            -webkit-user-select: text;
            -ms-user-select: text;
            user-select: text;
            border: dashed thin;
            border-color: lightgrey
        }

        table tbody tr:hover td {
            background: #daebfe;
        }

    .table-aligned-center {
        text-align: center
    }

    .selectable {
        color: blue;
    }

    #map {
        height: 100%;
        width: 100%;
    }

    .maptab {
        height: 100%;
    }

    .shiptable-map {
        width: 10px;
    }

    .popup {
        position: relative;
        display: inline-block;
        cursor: pointer;
    }

        .popup .popuptext {
            visibility: hidden;
            min-width: 350px;
            max-height: 62vh;
            background-color: #f2f8ff;
            color: dimgray;
            border-radius: 6px;
            border: solid;
            border-color: darkgray;
            border-style: thin;
            z-index: 1;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 0.7em;
            display: flex;
            flex-direction: column;
        }

        .popup .show {
            visibility: visible;
        }

    .popup_header {
        max-height: 15px;
        min-height: 15px;
        flex: 0 0 15px;
        color: white;
        background-color: #12a5ed;
        padding: 20px 10px 15px;
        font-size: 1em;
        font-weight: bold;
    }

    .popup_content {
        color: dimgrey;
        background-color: #f2f8ff;
        padding: 10px;
        overflow: auto;
        flex: 1;
    }

    .popup_content2 {
        color: dimgrey;
        padding: 0 10px;
        background-color: #f2f8ff;
        flex: 1;
    }

    .popup_footer {
        flex: 0 0 40px;
        min-height: 40px;
        max-height: 40px;
        color: white;
        background-color: grey;
        padding: 5px;
        display: flex;
        justify-content: stretch;
        border: solid;
    }

    .popup_icon {
        padding: 5px;
    }

        .popup_icon:hover {
            background-color: lightgrey;
        }

    .shipicon {
        background: url("data:image/png;base64,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");
        width: 20px;
        height: 20px;
        display: inline-block;
    }
</style>

<div class=header>AIS-catcher</div>
<div class=menubar>
    <div class=menu-item onclick="select_tab(event,'stat')" id=tab-default>STAT</div>
    <div class=menu-item onclick="select_tab(event,'plots')">PLOTS</div>
    <div class=menu-item onclick="select_tab(event,'shipstab')">SHIPS</div>
    <div class=menu-item onclick="select_tab(event,'map')" id=tab-map>MAP</div>
</div>
<div class=mainspace-container>
    <div class=mainspace>
        <div class=tabcontent id=stat>
            <div class=summarytab>
                <div class=summaryrow>
                    <div class=summary-box-left>
                        <div class=summary-text>Station</div>
                    </div>
                    <div class=summary-seperator></div>
                    <div class=summary-box-right>
                        <div class=summary-text id=stat_station></div>
                    </div>
                </div>
                <div class=summary-section></div>
                <div class=summaryrow>
                    <div class=summary-box-left>
                        <div class=summary-text>Device</div>
                    </div>
                    <div class=summary-seperator></div>
                    <div class=summary-box-right>
                        <div class=summary-text id=stat_product></div>
                    </div>
                </div>
                <div class=summaryrow>
                    <div class=summary-box-left>
                        <div class=summary-text>Vendor</div>
                    </div>
                    <div class=summary-seperator></div>
                    <div class=summary-box-right>
                        <div class=summary-text id=stat_vendor></div>
                    </div>
                </div>
                <div class=summaryrow>
                    <div class=summary-box-left>
                        <div class=summary-text>Serial</div>
                    </div>
                    <div class=summary-seperator></div>
                    <div class=summary-box-right>
                        <div class=summary-text id=stat_serial></div>
                    </div>
                </div>
                <div class=summary-section></div>
                <div class=summaryrow>
                    <div class=summary-box-left>
                        <div class=summary-text>Engine</div>
                    </div>
                    <div class=summary-seperator></div>
                    <div class=summary-box-right>
                        <div class=summary-text id=stat_model></div>
                    </div>
                </div>
                <div class=summaryrow>
                    <div class=summary-box-left>
                        <div class=summary-text>Sample Rate</div>
                    </div>
                    <div class=summary-seperator></div>
                    <div class=summary-box-right>
                        <div class=summary-text id=stat_sample_rate></div>
                    </div>
                </div>
                <div class=summaryrow>
                    <div class=summary-box-left>
                        <div class=summary-text>Data processed</div>
                    </div>
                    <div class=summary-seperator></div>
                    <div class=summary-box-right>
                        <div class=summary-text id=stat_data_received></div>
                    </div>
                </div>
                <div class=summaryrow>
                    <div class=summary-box-left>
                        <div class=summary-text>Running time</div>
                    </div>
                    <div class=summary-seperator></div>
                    <div class=summary-box-right>
                        <div class=summary-text id=stat_running_time></div>
                    </div>
                </div>
                <div class=summary-section></div>
                <div class=summaryrow>
                    <div class=summary-box-left>
                        <div class=summary-text>Total messages</div>
                    </div>
                    <div class=summary-seperator></div>
                    <div class=summary-box-right>
                        <div class=summary-text id=stat_total_msg></div>
                    </div>
                </div>

                <div class=summaryrow>
                    <div class=summary-box-left>
                        <div class=summary-text>Last hour</div>
                    </div>
                    <div class=summary-seperator></div>
                    <div class=summary-box-right>
                        <div class=summary-text id=stat_last_hour></div>
                    </div>
                </div>
                <div class=summaryrow>
                    <div class=summary-box-left>
                        <div class=summary-text>Last minute</div>
                    </div>
                    <div class=summary-seperator></div>
                    <div class=summary-box-right>
                        <div class=summary-text id=stat_last_minute></div>
                    </div>
                </div>


                <div class=summaryrow>
                    <div class=summary-box-left>
                        <div class=summary-text>Rate</div>
                    </div>
                    <div class=summary-seperator></div>
                    <div class=summary-box-right>
                        <div class=summary-text id=stat_msg_rate></div>
                    </div>
                </div>
                <div class=summaryrow>
                    <div class=summary-box-left>
                        <div class=summary-text>Vessels Seen</div>
                    </div>
                    <div class=summary-seperator></div>
                    <div class=summary-box-right>
                        <div class=summary-text id=stat_vessel_count></div>
                    </div>
                </div>
                <div class=summary-section></div>
                <div class=summaryrow>
                    <div class=summary-box-left>
                        <div class=summary-text>Channel A</div>
                    </div>
                    <div class=summary-seperator></div>
                    <div class=summary-box-right>
                        <div class=summary-text id=stat_channel_a></div>
                    </div>
                </div>
                <div class=summaryrow>
                    <div class=summary-box-left>
                        <div class=summary-text>Channel B</div>
                    </div>
                    <div class=summary-seperator></div>
                    <div class=summary-box-right>
                        <div class=summary-text id=stat_channel_b></div>
                    </div>
                </div>
                <div class=summary-section></div>
                <div class=summaryrow>
                    <div class=summary-box-left>
                        <div class=summary-text>Class A Position</div>
                    </div>
                    <div class=summary-seperator></div>
                    <div class=summary-box-right>
                        <div class=summary-text id=stat_msg123></div>
                    </div>
                </div>
                <div class=summaryrow>
                    <div class=summary-box-left>
                        <div class=summary-text>Class A Static</div>
                    </div>
                    <div class=summary-seperator></div>
                    <div class=summary-box-right>
                        <div class=summary-text id=stat_msg5></div>
                    </div>
                </div>
                <div class=summaryrow>
                    <div class=summary-box-left>
                        <div class=summary-text>Class B Position</div>
                    </div>
                    <div class=summary-seperator></div>
                    <div class=summary-box-right>
                        <div class=summary-text id=stat_msg1819></div>
                    </div>
                </div>
                <div class=summaryrow>
                    <div class=summary-box-left>
                        <div class=summary-text>Class B Static</div>
                    </div>
                    <div class=summary-seperator></div>
                    <div class=summary-box-right>
                        <div class=summary-text id=stat_msg24></div>
                    </div>
                </div>
                <div class=summaryrow>
                    <div class=summary-box-left>
                        <div class=summary-text>Base Station</div>
                    </div>
                    <div class=summary-seperator></div>
                    <div class=summary-box-right>
                        <div class=summary-text id=stat_msg4></div>
                    </div>
                </div>
                <div class=summaryrow>
                    <div class=summary-box-left>
                        <div class=summary-text>Other</div>
                    </div>
                    <div class=summary-seperator></div>
                    <div class=summary-box-right>
                        <div class=summary-text id=stat_msgother></div>
                    </div>
                </div>
            </div>
        </div>

        <div class=tabcontent id=plots>
            <div class=graphtab>
                <div class=graph_plot>
                    <div class=graph_header>Number of Messages per second</div>
                    <canvas id=chart-seconds class=graph></canvas>
                </div>
                <div class=graph_plot>
                    <div class=graph_header>Number of Messages per minute</div>
                    <canvas id=chart-minutes class=graph></canvas>
                </div>
                <div class=graph_plot>
                    <div class=graph_header>Number of Messages per hour</div>
                    <canvas id=chart-hours class=graph></canvas>
                </div>
                <div class=graph_plot>
                    <div class=graph_header>Frequency Shift (avg PPM per hour)</div>
                    <canvas id=chart-ppm class=graph></canvas>
                </div>
                <div class=graph_plot>
                    <div class=graph_header>Frequency Shift (avg PPM per minute)</div>
                    <canvas id=chart-ppm-minute class=graph></canvas>
                </div>
                <div class=graph_plot>
                    <div class=graph_header>Signal Level (avg dB per hour)</div>
                    <canvas id=chart-level class=graph></canvas>
                </div>
            </div>
        </div>

        <div class=tabcontent id=shipstab>
            <div class="popup">
                <div class="popuptext" id="popup_mmsi">
                    <div class="popup_header" id="popup_header_text"></div>
                    <div class="popup_content">
                        <div class=summary-section></div>
                        <div class=summaryrow>
                            <div class=summary-box-left>
                                <div class=popup-text>MMSI</div>
                            </div>
                            <div class=summary-seperator></div>
                            <div class=summary-box-right>
                                <div class=popup-text id=popup-mmsi></div>
                            </div>
                        </div>
                        <div class=summaryrow>
                            <div class=summary-box-left>
                                <div class=popup-text>Type</div>
                            </div>
                            <div class=summary-seperator></div>
                            <div class=summary-box-right>
                                <div class=popup-text id="popup-type"></div>
                            </div>
                        </div>
                        <div class=summaryrow>
                            <div class=summary-box-left>
                                <div class=popup-text>Shipname</div>
                            </div>
                            <div class=summary-seperator></div>
                            <div class=summary-box-right>
                                <div class=popup-text id="popup-shipname"></div>
                            </div>
                        </div>
                        <div class=summaryrow>
                            <div class=summary-box-left>
                                <div class=popup-text>Callsign</div>
                            </div>
                            <div class=summary-seperator></div>
                            <div class=summary-box-right>
                                <div class=popup-text id=popup-callsign></div>
                            </div>
                        </div>
                        <div class=summaryrow>
                            <div class=summary-box-left>
                                <div class=popup-text>Last Seen</div>
                            </div>
                            <div class=summary-seperator></div>
                            <div class=summary-box-right>
                                <div class=popup-text id=popup-last-signal></div>
                            </div>
                        </div>
                        <div class=summaryrow>
                            <div class=summary-box-left>
                                <div class=popup-text>Messages</div>
                            </div>
                            <div class=summary-seperator></div>
                            <div class=summary-box-right>
                                <div class=popup-text id=popup-count></div>
                            </div>
                        </div>
                        <div class=summaryrow>
                            <div class=summary-box-left>
                                <div class=popup-text>Freq offset</div>
                            </div>
                            <div class=summary-seperator></div>
                            <div class=summary-box-right>
                                <div class=popup-text id=popup-ppm></div>
                            </div>
                        </div>
                        <div class=summaryrow>
                            <div class=summary-box-left>
                                <div class=popup-text>RSSI</div>
                            </div>
                            <div class=summary-seperator></div>
                            <div class=summary-box-right>
                                <div class=popup-text id=popup-level></div>
                            </div>
                        </div>
                        <div class=summaryrow>
                            <div class=summary-box-left>
                                <div class=popup-text>Distance</div>
                            </div>
                            <div class=summary-seperator></div>
                            <div class=summary-box-right>
                                <div class=popup-text id=popup-distance></div>
                            </div>
                        </div>

                        <div class=summaryrow>
                            <div class=summary-box-left>
                                <div class=popup-text>Speed</div>
                            </div>
                            <div class=summary-seperator></div>
                            <div class=summary-box-right>
                                <div class=popup-text id=popup-speed></div>
                            </div>
                        </div>
                        <div class=summaryrow>
                            <div class=summary-box-left>
                                <div class=popup-text>Course</div>
                            </div>
                            <div class=summary-seperator></div>
                            <div class=summary-box-right>
                                <div class=popup-text id=popup-course></div>
                            </div>
                        </div>
                        <div class=summaryrow>
                            <div class=summary-box-left>
                                <div class=popup-text>Heading</div>
                            </div>
                            <div class=summary-seperator></div>
                            <div class=summary-box-right>
                                <div class=popup-text id=popup-heading></div>
                            </div>
                        </div>
                        <div class=summaryrow>
                            <div class=summary-box-left>
                                <div class=popup-text>Status</div>
                            </div>
                            <div class=summary-seperator></div>
                            <div class=summary-box-right>
                                <div class=popup-text id=popup-status></div>
                            </div>
                        </div>
                        <div class=summaryrow>
                            <div class=summary-box-left>
                                <div class=popup-text>Destination</div>
                            </div>
                            <div class=summary-seperator></div>
                            <div class=summary-box-right>
                                <div class=popup-text id=popup-destination></div>
                            </div>
                        </div>
                        <div class=summaryrow>
                            <div class=summary-box-left>
                                <div class=popup-text>Ship type</div>
                            </div>
                            <div class=summary-seperator></div>
                            <div class=summary-box-right>
                                <div class=popup-text id=popup-shiptype></div>
                            </div>
                        </div>


                        <div class=summary-section></div>
                    </div>
                    <div id="popup_text" class="popup_content2"></div>
                    <div class="popup_footer">
                        <div style="flex:1;"></div>
                        <div class="popup_icon" id="popup-gmaps-icon">
                            <div style="flex: 0 0 150px; padding: 10px; color: white"><i class="fa-brands fa-google fa-lg"></i></div>
                        </div>
                        <div class="popup_icon" id="popup-map-icon">
                            <div style="flex: 0 0 150px; color: white; padding: 10px"><i class="fa-regular fa-map fa-lg"></i></div>
                        </div>
                        <div class="popup_icon" onclick="toggle_popup()">
                            <div style="flex: 0 0 150px; color: red; padding: 10px"><i class="fa-sharp fa-solid fa-xmark fa-lg"></i></div>
                        </div>
                        <div style="flex:1;"></div>
                    </div>
                </div>

            </div>

            <div class=tablesection>
                <table id=shipTable>
                    <thead>
                        <tr>
                            <th onclick="sort_table(this)" field="mmsi" sortable="N">MMSI <i class="fa-solid fa-sort"></i>
                            <th onclick="sort_table(this)" field="shipname" sortable="T">Shipname <i class="fa-solid fa-sort"></i>
                            <th onclick="sort_table(this)" field="callsign" sortable="T">Callsign <i class="fa-solid fa-sort"></i>
                            <th onclick="sort_table(this)" field="last_signal" sortable="N">Last Seen <i class="fa-solid fa-sort"></i>
                            <th onclick="sort_table(this)" field="count" sortable="N">Msgs <i class="fa-solid fa-sort"></i>
                            <th onclick="sort_table(this)" field="ppm" sortable="N">Freq Drift <i class="fa-solid fa-sort"></i>
                            <th onclick="sort_table(this)" field="level" sortable="N">RSSI <i class="fa-solid fa-sort"></i>
                            <th onclick="sort_table(this)" field="distance" sortable="N">Distance (nmi) <i class="fa-solid fa-sort"></i>
                            <th onclick="sort_table(this)" field="lat" sortable="N">Lat <i class="fa-solid fa-sort"></i>
                            <th onclick="sort_table(this)" field="lon" sortable="N">Lon <i class="fa-solid fa-sort"></i>
                        </tr>
                    </thead>
                    <tbody id=shipTableBody>
                </table>
            </div>
        </div>
        <div class=tabcontent id=map>
            <div class="maptab">
                <div id="map"></div>
            </div>
        </div>

    </div>
</div>
<div class=bottombar></div>

<script>
    var chart_seconds, chart_minutes, interval, hist, lock_mmsi, ships, map_coord_set = false,
        markers = {};
    var losses = 0;
    var ship_infocus = -1;
    var table_sort = "distance";
    var table_dir = "asc";
    var table_type = "N";
    var popup_ship = null;

    const StringFromStatus = ["Under way using engine",
        "At anchor",
        "Not under command",
        "Restricted manoeuverability",
        "Constrained",
        "Moored",
        "Aground",
        "Engaged in Fishing",
        "Under way sailing",
        "Reserved for HSC",
        "Reserved for WIG",
        "Reserved",
        "Reserved",
        "Reserved",
        "AIS-SART is active",
        "Not available"
    ];

    // var ships_json = '{"count":80,"ships":[{"mmsi":244033000,"lat":52.106731,"lon":4.243540,"distance":3.561193,"mmsi_type":1,"level":-10.647472,"count":92,"ppm":-0.868056,"heading":83,"cog":78.700005,"speed":10.400001,"shiptype":90,"msg_type":0,"status":8,"callsign":"PBV0","shipname":"TRIDENS","destination":"SCHEVENINGEN","last_signal":1},{"mmsi":636019203,"lat":51.934402,"lon":4.192946,"distance":10.626541,"mmsi_type":1,"level":-16.041666,"count":20,"ppm":-0.289352,"heading":311,"cog":129.400009,"speed":0.000000,"shiptype":80,"msg_type":0,"status":5,"callsign":"D5TK7","shipname":"CHEM NEON","destination":"NLRTM","last_signal":1},{"mmsi":2442006,"lat":52.104149,"lon":4.268283,"distance":2.649348,"mmsi_type":3,"level":-10.326877,"count":1034,"ppm":0.000000,"heading":511,"cog":360.000000,"speed":0.000000,"shiptype":0,"msg_type":0,"status":15,"callsign":"","shipname":"","destination":"","last_signal":3},{"mmsi":246003000,"lat":52.099350,"lon":4.263947,"distance":2.713862,"mmsi_type":1,"level":-14.212875,"count":323,"ppm":-2.893518,"heading":511,"cog":360.000000,"speed":0.000000,"shiptype":52,"msg_type":0,"status":0,"callsign":"PGLK","shipname":"OCEAAN 2","destination":"SCHEVENINGEN","last_signal":4},{"mmsi":244770939,"lat":52.190891,"lon":4.136207,"distance":9.584921,"mmsi_type":1,"level":-15.833647,"count":300,"ppm":-1.157407,"heading":511,"cog":360.000000,"speed":0.000000,"shiptype":0,"msg_type":0,"status":15,"callsign":"","shipname":"","destination":"","last_signal":5},{"mmsi":249532000,"lat":51.968334,"lon":4.119333,"distance":10.743217,"mmsi_type":1,"level":-16.215675,"count":2,"ppm":-0.868056,"heading":302,"cog":303.000000,"speed":8.000000,"shiptype":0,"msg_type":0,"status":0,"callsign":"","shipname":"","destination":"","last_signal":6},{"mmsi":538010155,"lat":51.961067,"lon":4.125083,"distance":10.888238,"mmsi_type":1,"level":-14.964648,"count":10,"ppm":-1.736111,"heading":153,"cog":125.000000,"speed":0.000000,"shiptype":70,"msg_type":0,"status":5,"callsign":"V7A5689","shipname":"BULK HALMAHERA","destination":"ROTTERDAM","last_signal":8},{"mmsi":244974000,"lat":52.099201,"lon":4.263577,"distance":2.724907,"mmsi_type":1,"level":-16.288187,"count":102,"ppm":0.000000,"heading":320,"cog":150.500000,"speed":0.000000,"shiptype":0,"msg_type":0,"status":0,"callsign":"","shipname":"","destination":"","last_signal":9},{"mmsi":229191000,"lat":51.944626,"lon":4.074285,"distance":12.934983,"mmsi_type":1,"level":-16.996233,"count":11,"ppm":-0.578704,"heading":34,"cog":183.600006,"speed":0.000000,"shiptype":71,"msg_type":0,"status":5,"callsign":"9HA3137","shipname":"X-PRESS GODAVARI","destination":"NLRTM","last_signal":13},{"mmsi":992456989,"lat":53.097534,"lon":4.731300,"distance":62.318882,"mmsi_type":6,"level":-9.910373,"count":113,"ppm":0.289352,"heading":511,"cog":360.000000,"speed":0.000000,"shiptype":0,"msg_type":0,"status":15,"callsign":"","shipname":"ZINKER NEW..","destination":"","last_signal":13},{"mmsi":538005871,"lat":51.944763,"lon":4.161788,"distance":10.735441,"mmsi_type":1,"level":-17.378344,"count":110,"ppm":0.578704,"heading":353,"cog":287.899994,"speed":0.400000,"shiptype":80,"msg_type":0,"status":4,"callsign":"V7HT4","shipname":"OLYMPIC LION","destination":"ROTTERDAM","last_signal":23},{"mmsi":244692000,"lat":52.111172,"lon":4.169740,"distance":6.258989,"mmsi_type":1,"level":-17.111923,"count":1,"ppm":0.868056,"heading":92,"cog":101.700005,"speed":11.900001,"shiptype":0,"msg_type":0,"status":5,"callsign":"","shipname":"","destination":"","last_signal":28},{"mmsi":246951000,"lat":52.099545,"lon":4.263953,"distance":2.716535,"mmsi_type":1,"level":-16.337339,"count":8,"ppm":-1.736111,"heading":220,"cog":360.000000,"speed":0.000000,"shiptype":0,"msg_type":0,"status":5,"callsign":"","shipname":"","destination":"","last_signal":30},{"mmsi":249525000,"lat":51.952801,"lon":4.145317,"distance":10.739420,"mmsi_type":1,"level":-18.610966,"count":69,"ppm":0.000000,"heading":87,"cog":219.000000,"speed":0.100000,"shiptype":52,"msg_type":0,"status":0,"callsign":"9HB4828","shipname":"VB HUDSON","destination":"ROTTERDAM","last_signal":33},{"mmsi":636020533,"lat":51.899181,"lon":4.371663,"distance":11.429219,"mmsi_type":1,"level":-17.090649,"count":1,"ppm":-3.472222,"heading":276,"cog":277.200012,"speed":8.700000,"shiptype":0,"msg_type":0,"status":0,"callsign":"","shipname":"","destination":"","last_signal":47},{"mmsi":244805000,"lat":52.099167,"lon":4.269667,"distance":2.507006,"mmsi_type":1,"level":-17.258951,"count":2,"ppm":0.289352,"heading":309,"cog":78.700005,"speed":0.000000,"shiptype":0,"msg_type":0,"status":5,"callsign":"","shipname":"","destination":"","last_signal":49},{"mmsi":304027000,"lat":51.946777,"lon":4.162263,"distance":10.627995,"mmsi_type":1,"level":-18.388866,"count":19,"ppm":-0.578704,"heading":260,"cog":291.000000,"speed":0.600000,"shiptype":0,"msg_type":0,"status":0,"callsign":"","shipname":"","destination":"","last_signal":51},{"mmsi":244140645,"lat":52.095055,"lon":4.264347,"distance":2.647271,"mmsi_type":2,"level":-16.869680,"count":8,"ppm":-0.578704,"heading":511,"cog":360.000000,"speed":0.000000,"shiptype":36,"msg_type":0,"status":15,"callsign":"PB3362","shipname":"RODE DRAECK (TRI)","destination":"","last_signal":57},{"mmsi":244100994,"lat":52.095146,"lon":4.264230,"distance":2.652390,"mmsi_type":2,"level":-13.662269,"count":34,"ppm":0.868056,"heading":511,"cog":360.000000,"speed":0.100000,"shiptype":36,"msg_type":0,"status":15,"callsign":"PG5302","shipname":"ROXANNE","destination":"","last_signal":58},{"mmsi":249502000,"lat":51.957123,"lon":4.142005,"distance":10.625924,"mmsi_type":1,"level":-15.258693,"count":16,"ppm":-0.868056,"heading":290,"cog":289.700012,"speed":4.100000,"shiptype":0,"msg_type":0,"status":0,"callsign":"","shipname":"","destination":"","last_signal":60},{"mmsi":374887000,"lat":51.926033,"lon":4.208847,"distance":10.799394,"mmsi_type":1,"level":-13.494340,"count":48,"ppm":-2.025463,"heading":128,"cog":69.300003,"speed":0.000000,"shiptype":99,"msg_type":0,"status":5,"callsign":"3FER4","shipname":"SLEIPNIR","destination":"ROTTERDAM","last_signal":93},{"mmsi":241220000,"lat":51.951698,"lon":4.145957,"distance":10.774312,"mmsi_type":1,"level":-17.341219,"count":109,"ppm":-1.157407,"heading":358,"cog":65.000000,"speed":0.100000,"shiptype":80,"msg_type":0,"status":0,"callsign":"SVBP8","shipname":"KING GREGORY","destination":"GB LTP","last_signal":94},{"mmsi":477654700,"lat":51.965519,"lon":4.113090,"distance":11.027994,"mmsi_type":1,"level":-14.097247,"count":21,"ppm":-1.157407,"heading":113,"cog":343.100006,"speed":0.000000,"shiptype":70,"msg_type":0,"status":5,"callsign":"VROW6","shipname":"OCEAN VENTURE","destination":"NL RTM","last_signal":102},{"mmsi":244758000,"lat":51.972172,"lon":4.133592,"distance":10.199019,"mmsi_type":1,"level":-17.967371,"count":14,"ppm":-1.157407,"heading":130,"cog":261.500000,"speed":0.000000,"shiptype":0,"msg_type":0,"status":0,"callsign":"","shipname":"","destination":"","last_signal":122},{"mmsi":304068000,"lat":51.963902,"lon":4.095117,"distance":11.593261,"mmsi_type":1,"level":-19.186892,"count":1,"ppm":-0.868056,"heading":290,"cog":27.100000,"speed":0.000000,"shiptype":0,"msg_type":0,"status":0,"callsign":"","shipname":"","destination":"","last_signal":135},{"mmsi":311000615,"lat":52.185932,"lon":4.243203,"distance":6.781064,"mmsi_type":1,"level":-8.782345,"count":15,"ppm":-1.157407,"heading":293,"cog":19.200001,"speed":0.400000,"shiptype":34,"msg_type":0,"status":1,"callsign":"C6CZ6","shipname":"MPV EVEREST","destination":"SCHEVENINGEN","last_signal":142},{"mmsi":244076746,"lat":51.908401,"lon":4.256670,"distance":11.179443,"mmsi_type":1,"level":-16.559652,"count":1,"ppm":-3.472222,"heading":511,"cog":122.599998,"speed":9.800000,"shiptype":0,"msg_type":0,"status":0,"callsign":"","shipname":"","destination":"","last_signal":152},{"mmsi":246006000,"lat":52.099918,"lon":4.264472,"distance":2.703798,"mmsi_type":1,"level":-16.487389,"count":10,"ppm":-2.025463,"heading":220,"cog":109.500000,"speed":0.100000,"shiptype":99,"msg_type":0,"status":5,"callsign":"PFBK","shipname":"VLIESTROOM","destination":"SCHEVENINGEN","last_signal":165},{"mmsi":244719315,"lat":52.074001,"lon":4.317742,"distance":1.066909,"mmsi_type":1,"level":-4.377248,"count":39,"ppm":-3.182870,"heading":511,"cog":360.000000,"speed":0.000000,"shiptype":8000,"msg_type":0,"status":5,"callsign":"PG6249","shipname":"ST.RAFAEL","destination":"","last_signal":171},{"mmsi":244850097,"lat":52.204216,"lon":4.241350,"distance":7.781239,"mmsi_type":1,"level":-17.086792,"count":13,"ppm":-0.289352,"heading":274,"cog":235.300003,"speed":0.000000,"shiptype":70,"msg_type":0,"status":1,"callsign":"P.C.Z.S","shipname":"BIGROLL BEAUFORT","destination":"SCHEVENINGEN","last_signal":171},{"mmsi":244092000,"lat":52.171352,"lon":4.223495,"distance":6.475099,"mmsi_type":1,"level":-7.281817,"count":27,"ppm":-0.868056,"heading":275,"cog":230.500000,"speed":0.000000,"shiptype":80,"msg_type":0,"status":1,"callsign":"PHNJ","shipname":"CORAL METHANE","destination":"NLSCE","last_signal":174},{"mmsi":271043776,"lat":51.972424,"lon":4.104725,"distance":10.992674,"mmsi_type":1,"level":-18.086121,"count":76,"ppm":0.289352,"heading":295,"cog":296.100006,"speed":9.600000,"shiptype":80,"msg_type":0,"status":0,"callsign":"TCNZ8","shipname":"DUZGIT DIGNITY","destination":"NO HRD","last_signal":178},{"mmsi":209870000,"lat":51.959381,"lon":4.125780,"distance":10.941339,"mmsi_type":1,"level":-15.718481,"count":16,"ppm":-0.578704,"heading":331,"cog":333.700012,"speed":0.000000,"shiptype":70,"msg_type":0,"status":5,"callsign":"5BXE3","shipname":"ZOE","destination":"NL RTM","last_signal":179},{"mmsi":244150813,"lat":51.906063,"lon":4.226117,"distance":11.656358,"mmsi_type":1,"level":-18.093359,"count":15,"ppm":-4.918982,"heading":350,"cog":349.000000,"speed":6.000000,"shiptype":0,"msg_type":0,"status":0,"callsign":"","shipname":"","destination":"","last_signal":185},{"mmsi":244870700,"lat":52.099319,"lon":4.266088,"distance":2.636899,"mmsi_type":1,"level":-19.121580,"count":6,"ppm":0.000000,"heading":222,"cog":120.200005,"speed":0.000000,"shiptype":0,"msg_type":0,"status":3,"callsign":"","shipname":"","destination":"","last_signal":199},{"mmsi":244034000,"mmsi_type":1,"level":-17.557037,"count":60,"ppm":-0.289352,"heading":511,"cog":360.000000,"speed":0.000000,"shiptype":0,"msg_type":0,"status":0,"callsign":"","shipname":"","destination":"","last_signal":205},{"mmsi":244170512,"lat":52.095467,"lon":4.265867,"distance":2.595941,"mmsi_type":2,"level":-17.364134,"count":3,"ppm":-1.157407,"heading":305,"cog":99.200005,"speed":0.000000,"shiptype":36,"msg_type":0,"status":15,"callsign":"PD9708","shipname":"","destination":"","last_signal":210},{"mmsi":245427000,"lat":51.973568,"lon":4.027322,"distance":13.295800,"mmsi_type":1,"level":-18.633810,"count":2,"ppm":-1.157407,"heading":292,"cog":289.600006,"speed":4.400000,"shiptype":0,"msg_type":0,"status":8,"callsign":"","shipname":"","destination":"","last_signal":228},{"mmsi":992456978,"lat":52.385208,"lon":3.949677,"distance":22.788647,"mmsi_type":6,"level":-10.062133,"count":9,"ppm":0.000000,"heading":511,"cog":360.000000,"speed":0.000000,"shiptype":0,"msg_type":0,"status":15,"callsign":"","shipname":"WTG E4 HZ","destination":"","last_signal":243},{"mmsi":992446043,"lat":52.174767,"lon":4.128083,"distance":9.239150,"mmsi_type":6,"level":-9.974407,"count":9,"ppm":0.000000,"heading":511,"cog":360.000000,"speed":0.000000,"shiptype":0,"msg_type":0,"status":15,"callsign":"","shipname":"OFFSHORE TEST SITE -","destination":"","last_signal":244},{"mmsi":992446044,"lat":52.155315,"lon":4.102433,"distance":9.483751,"mmsi_type":6,"level":-9.919700,"count":9,"ppm":0.000000,"heading":511,"cog":360.000000,"speed":0.000000,"shiptype":0,"msg_type":0,"status":15,"callsign":"","shipname":"OFFSHORE TEST SITE -","destination":"","last_signal":244},{"mmsi":992456984,"lat":52.270466,"lon":4.043877,"distance":15.329193,"mmsi_type":6,"level":-10.103064,"count":9,"ppm":3.761574,"heading":511,"cog":360.000000,"speed":0.000000,"shiptype":0,"msg_type":0,"status":15,"callsign":"","shipname":"WTG M5 HZ","destination":"","last_signal":245},{"mmsi":992456975,"lat":52.257668,"lon":4.084667,"distance":13.740165,"mmsi_type":6,"level":-9.867437,"count":9,"ppm":0.000000,"heading":511,"cog":360.000000,"speed":0.000000,"shiptype":0,"msg_type":0,"status":15,"callsign":"","shipname":"OHVS HZB","destination":"","last_signal":245},{"mmsi":992456985,"lat":52.256535,"lon":3.943923,"distance":17.605692,"mmsi_type":6,"level":-9.910283,"count":9,"ppm":0.000000,"heading":511,"cog":360.000000,"speed":0.000000,"shiptype":0,"msg_type":0,"status":15,"callsign":"","shipname":"WTG K6 HZ","destination":"","last_signal":245},{"mmsi":992446042,"lat":52.183750,"lon":4.105300,"distance":10.236405,"mmsi_type":6,"level":-9.966354,"count":9,"ppm":0.000000,"heading":511,"cog":360.000000,"speed":0.000000,"shiptype":0,"msg_type":0,"status":15,"callsign":"","shipname":"OFFSHORE TEST SITE -","destination":"","last_signal":245},{"mmsi":992456983,"lat":52.318867,"lon":4.030958,"distance":17.815298,"mmsi_type":6,"level":-9.759583,"count":8,"ppm":-0.578704,"heading":511,"cog":360.000000,"speed":0.000000,"shiptype":0,"msg_type":0,"status":15,"callsign":"","shipname":"WTG G1 HZ","destination":"","last_signal":246},{"mmsi":992456981,"lat":52.346073,"lon":3.934937,"distance":21.373941,"mmsi_type":6,"level":-9.759119,"count":8,"ppm":0.000000,"heading":511,"cog":360.000000,"speed":0.000000,"shiptype":0,"msg_type":0,"status":15,"callsign":"","shipname":"WTG F4 HZ","destination":"","last_signal":246},{"mmsi":992456982,"lat":52.320374,"lon":3.926603,"distance":20.510231,"mmsi_type":6,"level":-9.879526,"count":9,"ppm":0.000000,"heading":511,"cog":360.000000,"speed":0.000000,"shiptype":0,"msg_type":0,"status":15,"callsign":"","shipname":"WTG G6 HZ","destination":"","last_signal":246},{"mmsi":992456974,"lat":52.191116,"lon":4.136183,"distance":9.594272,"mmsi_type":6,"level":-9.834064,"count":9,"ppm":-2.893518,"heading":511,"cog":360.000000,"speed":0.000000,"shiptype":0,"msg_type":0,"status":15,"callsign":"","shipname":"Q13A-A PLATFORM","destination":"","last_signal":246},{"mmsi":992456979,"lat":52.384068,"lon":4.044291,"distance":20.743959,"mmsi_type":6,"level":-10.320801,"count":9,"ppm":0.000000,"heading":511,"cog":360.000000,"speed":0.000000,"shiptype":0,"msg_type":0,"status":15,"callsign":"","shipname":"WTG D6 HZ","destination":"","last_signal":246},{"mmsi":992456972,"lat":52.319500,"lon":4.043167,"distance":17.566347,"mmsi_type":6,"level":-9.832211,"count":9,"ppm":0.000000,"heading":511,"cog":360.000000,"speed":0.000000,"shiptype":0,"msg_type":0,"status":15,"callsign":"","shipname":"OHVS HZA","destination":"","last_signal":247},{"mmsi":992446045,"lat":52.165031,"lon":4.078050,"distance":10.545738,"mmsi_type":6,"level":-9.836595,"count":8,"ppm":0.000000,"heading":511,"cog":360.000000,"speed":0.000000,"shiptype":0,"msg_type":0,"status":15,"callsign":"","shipname":"OFFSHORE TEST SITE -","destination":"","last_signal":247},{"mmsi":992456980,"lat":52.347366,"lon":4.019804,"distance":19.417080,"mmsi_type":6,"level":-9.870238,"count":9,"ppm":0.000000,"heading":511,"cog":360.000000,"speed":0.000000,"shiptype":0,"msg_type":0,"status":15,"callsign":"","shipname":"WTG D1 HZ","destination":"","last_signal":247},{"mmsi":244820418,"lat":51.900181,"lon":4.359688,"distance":11.325644,"mmsi_type":1,"level":-15.560408,"count":10,"ppm":-3.761574,"heading":259,"cog":262.700012,"speed":11.100000,"shiptype":0,"msg_type":0,"status":0,"callsign":"","shipname":"","destination":"","last_signal":260},{"mmsi":477271100,"lat":51.966915,"lon":4.108065,"distance":11.111656,"mmsi_type":1,"level":-15.539368,"count":9,"ppm":-0.868056,"heading":114,"cog":359.500000,"speed":0.000000,"shiptype":70,"msg_type":0,"status":5,"callsign":"VRNH7","shipname":"KSL SAPPORO","destination":"FREETOWN","last_signal":285},{"mmsi":244336000,"lat":51.959190,"lon":4.129344,"distance":10.856771,"mmsi_type":1,"level":-15.932692,"count":2,"ppm":-0.578704,"heading":161,"cog":151.900009,"speed":3.200000,"shiptype":0,"msg_type":0,"status":0,"callsign":"","shipname":"","destination":"","last_signal":329},{"mmsi":249110000,"lat":51.961666,"lon":3.977000,"distance":15.262245,"mmsi_type":1,"level":-17.128571,"count":3,"ppm":-0.289352,"heading":33,"cog":148.000000,"speed":0.000000,"shiptype":0,"msg_type":0,"status":5,"callsign":"","shipname":"","destination":"","last_signal":393},{"mmsi":244710825,"lat":52.099312,"lon":4.270263,"distance":2.488108,"mmsi_type":1,"level":-19.097841,"count":7,"ppm":1.736111,"heading":511,"cog":0.000000,"speed":0.000000,"shiptype":0,"msg_type":0,"status":7,"callsign":"","shipname":"","destination":"","last_signal":402},{"mmsi":311054500,"lat":51.951225,"lon":4.127312,"distance":11.254650,"mmsi_type":1,"level":-19.038782,"count":1,"ppm":-1.157407,"heading":186,"cog":340.100006,"speed":0.000000,"shiptype":0,"msg_type":0,"status":5,"callsign":"","shipname":"","destination":"","last_signal":477},{"mmsi":249903000,"lat":51.886101,"lon":4.437967,"distance":12.716271,"mmsi_type":1,"level":-16.634041,"count":4,"ppm":0.578704,"heading":242,"cog":238.100006,"speed":0.000000,"shiptype":90,"msg_type":0,"status":5,"callsign":"9HA4426","shipname":"OCEANIC","destination":"WAALHAVEN","last_signal":516},{"mmsi":246975000,"lat":52.100815,"lon":4.268297,"distance":2.583129,"mmsi_type":1,"level":-17.670137,"count":218,"ppm":5.208333,"heading":44,"cog":34.799999,"speed":0.000000,"shiptype":30,"msg_type":0,"status":0,"callsign":"PEOE","shipname":"WIRON 1","destination":"SCHEVENINGEN","last_signal":574},{"mmsi":305498000,"lat":51.944401,"lon":4.161365,"distance":10.762261,"mmsi_type":1,"level":-17.420256,"count":12,"ppm":3.182870,"heading":99,"cog":99.099998,"speed":0.200000,"shiptype":0,"msg_type":0,"status":8,"callsign":"","shipname":"","destination":"","last_signal":604},{"mmsi":636016248,"lat":51.894516,"lon":4.246984,"distance":12.078611,"mmsi_type":1,"level":-15.527011,"count":128,"ppm":-2.893518,"heading":287,"cog":100.000000,"speed":1.100000,"shiptype":70,"msg_type":0,"status":0,"callsign":"D5FF4","shipname":"TOKYO CAR","destination":"NL RTM","last_signal":611},{"mmsi":236263000,"lat":51.931221,"lon":4.194117,"distance":10.772070,"mmsi_type":1,"level":-17.784349,"count":19,"ppm":-2.893518,"heading":135,"cog":131.300003,"speed":6.200000,"shiptype":0,"msg_type":0,"status":0,"callsign":"","shipname":"","destination":"","last_signal":631},{"mmsi":305440000,"lat":51.901073,"lon":4.428622,"distance":11.754840,"mmsi_type":1,"level":-15.316096,"count":1,"ppm":0.000000,"heading":93,"cog":93.800003,"speed":6.400000,"shiptype":0,"msg_type":0,"status":0,"callsign":"","shipname":"","destination":"","last_signal":796},{"mmsi":538009709,"lat":51.883556,"lon":4.443802,"distance":12.927628,"mmsi_type":1,"level":-16.407654,"count":4,"ppm":-0.868056,"heading":248,"cog":337.300018,"speed":0.100000,"shiptype":79,"msg_type":0,"status":5,"callsign":"V7A5071","shipname":"STEADY SARAH","destination":"NL RTM","last_signal":1008},{"mmsi":211138300,"lat":51.945461,"lon":4.166798,"distance":10.591946,"mmsi_type":1,"level":-17.724846,"count":7,"ppm":-1.446759,"heading":67,"cog":27.600000,"speed":1.100000,"shiptype":0,"msg_type":0,"status":0,"callsign":"","shipname":"","destination":"","last_signal":1097},{"mmsi":245655000,"lat":52.098347,"lon":4.268470,"distance":2.537325,"mmsi_type":1,"level":-18.325493,"count":1,"ppm":-0.868056,"heading":223,"cog":59.000000,"speed":0.000000,"shiptype":0,"msg_type":0,"status":7,"callsign":"","shipname":"","destination":"","last_signal":1108},{"mmsi":538007597,"lat":51.966076,"lon":4.059114,"distance":12.563614,"mmsi_type":1,"level":-18.629223,"count":11,"ppm":-0.289352,"heading":291,"cog":290.899994,"speed":5.700000,"shiptype":0,"msg_type":0,"status":0,"callsign":"","shipname":"","destination":"","last_signal":1157},{"mmsi":305648000,"lat":51.959999,"lon":4.068666,"distance":12.500563,"mmsi_type":1,"level":-17.321692,"count":36,"ppm":-3.182870,"heading":84,"cog":233.000000,"speed":0.200000,"shiptype":0,"msg_type":0,"status":0,"callsign":"","shipname":"","destination":"","last_signal":1235},{"mmsi":310755000,"lat":52.015099,"lon":3.957328,"distance":14.629399,"mmsi_type":1,"level":-14.009727,"count":76,"ppm":-0.289352,"heading":290,"cog":292.300018,"speed":10.900001,"shiptype":80,"msg_type":0,"status":0,"callsign":"ZCEU2","shipname":"GASLOG GENEVA","destination":"NLRTM","last_signal":1661},{"mmsi":245732000,"mmsi_type":1,"level":-16.679443,"count":1,"ppm":-1.157407,"heading":511,"cog":360.000000,"speed":0.000000,"shiptype":79,"msg_type":0,"status":15,"callsign":"PBIK","shipname":"ROLLDOCK STAR","destination":"NLSCE","last_signal":1720},{"mmsi":314475000,"lat":51.946388,"lon":4.182742,"distance":10.210226,"mmsi_type":1,"level":-18.763287,"count":15,"ppm":-0.578704,"heading":303,"cog":302.000000,"speed":11.300000,"shiptype":0,"msg_type":0,"status":0,"callsign":"","shipname":"","destination":"","last_signal":1749}],"error":false}';

    var map = L.map('map').setView([0, 0], 10);
    /*
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);
    */

    L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
        subdomains: 'abcd',
        maxZoom: 20
    }).addTo(map);

    var active_tab = "not-set";

    function average(d) {
        const b = d.chart.data.datasets[0].data;
        if (b.length == 1) return b[0].y;

        var c = 0,
            a;

        for (a = 0; a < b.length; a++)
            if (b[a].x != 0) c += b[a].y;
        return c / (b.length - 1);
    }

    const graph_annotation = {
        type: 'line',
        borderColor: 'rgba(12,118,170)',
        borderDash: [6, 6],
        borderDashOffset: 0,
        borderWidth: 3,
        scaleID: 'y',
        value: a => average(a)
    };

    const graph_options = {
        plugins: {
            legend: {
                display: !1,
                labels: {
                    color: 'rgb(255, 99, 132)'
                }
            },
            annotation: {
                annotations: {
                    graph_annotation
                }
            }
        },
        elements: {
            point: {
                radius: 1
            }
        },
        animation: false,
        tooltips: {
            mode: 'index',
            intersect: !1
        },
        hover: {
            mode: 'nearest',
            intersect: true
        },
        scales: {
            y: {
                beginAtZero: true,
                ticks: {
                    display: true
                }
            },
            x: {
                ticks: {
                    display: true
                }
            }
        }
    };

    plot_seconds = {
        type: 'scatter',
        data: {
            datasets: [{
                data: [],
                showLine: !0,
                fill: true,
                borderColor: 'rgba(18,165,237)',
                backgroundColor: 'rgba(18,165,237,0.1)',
                borderWidth: 1
            }]
        },
        options: graph_options
    };

    plot_minutes = {
        type: 'scatter',
        data: {
            datasets: [{
                data: [],
                showLine: !0,
                fill: true,
                borderColor: 'rgba(18,165,237)',
                backgroundColor: 'rgba(18,165,237,0.1)',
                borderWidth: 1
            }]
        },
        options: graph_options
    };

    plot_hours = {
        type: 'scatter',
        data: {
            datasets: [{
                data: [],
                showLine: true,
                fill: true,
                borderColor: 'rgba(18,165,237)',
                backgroundColor: 'rgba(18,165,237,0.1)',
                borderWidth: 1
            }]
        },
        options: graph_options
    };

    chart_seconds = new Chart(document.getElementById('chart-seconds'), plot_seconds);
    chart_minutes = new Chart(document.getElementById('chart-minutes'), plot_minutes);
    chart_hours = new Chart(document.getElementById('chart-hours'), plot_hours);
    chart_ppm = new Chart(document.getElementById('chart-ppm'), plot_hours);
    chart_ppm_minute = new Chart(document.getElementById('chart-ppm-minute'), plot_hours);
    chart_level = new Chart(document.getElementById('chart-level'), plot_hours);


    function StringFromShipType(s) {
        if (s < 20) return "Not available";
        if (s <= 29) return "WIG";
        if (s <= 30) return "Fishing";
        if (s <= 32) return "Towing";
        if (s <= 34) return "Dredging/Diving ops";
        if (s <= 35) return "Military";
        if (s <= 36) return "Sailing";
        if (s <= 37) return "Pleasure Craft";
        if (s <= 49) return "High Speed Craft";
        if (s <= 50) return "Pilot";
        if (s <= 51) return "Search And Rescue";
        if (s <= 52) return "Tug";
        if (s <= 53) return "Port tender";
        if (s <= 54) return "Anti-pollution equipment";
        if (s <= 55) return "Law Enforcement";
        if (s <= 58) return "Medical Transport";
        if (s <= 59) return "Noncombatant ship";
        if (s <= 69) return "Passenger";
        if (s <= 79) return "Cargo";
        if (s <= 89) return "Tanker";
        if (s <= 99) return "Other";

        return "Not available";
    }

    function deltaTimeToStr(s) {
        if (s < 120) return s + "s";
        if (s < 60 * 120) return Math.floor(s / 60) + "m";
        return Math.floor(s / 3600) + "h"
    }

    async function display_stats() {

        const g = await fetch('stat.json');
        a = await g.json();

        document.getElementById("stat_total_msg").innerHTML = a.total;
        document.getElementById("stat_msg_rate").innerHTML = Number(a.msg_rate).toFixed(1) + " msg/s";
        document.getElementById("stat_last_minute").innerHTML = a.last_minute;
        document.getElementById("stat_last_hour").innerHTML = a.last_hour;

        if (a.vessel_count < a.vessel_max)
            document.getElementById("stat_vessel_count").innerHTML = a.vessel_count;
        else
            document.getElementById("stat_vessel_count").innerHTML = "> " + a.vessel_count;

        document.getElementById("stat_channel_a").innerHTML = a.msgA;
        document.getElementById("stat_channel_b").innerHTML = a.msgB;

        msg123 = a.msg1 + a.msg2 + a.msg3;
        msg1819 = a.msg18 + a.msg19

        document.getElementById("stat_msg123").innerHTML = msg123
        document.getElementById("stat_msg5").innerHTML = a.msg5;
        document.getElementById("stat_msg1819").innerHTML = msg1819;
        document.getElementById("stat_msg24").innerHTML = a.msg24;
        document.getElementById("stat_msg4").innerHTML = a.msg4;
        document.getElementById("stat_msgother").innerHTML = a.total - msg123 - a.msg5 - msg1819 - a.msg24 - a.msg4;

        document.getElementById("stat_data_received").innerHTML = a.received;
        document.getElementById("stat_running_time").innerHTML = a.run_time;
        document.getElementById("stat_product").innerHTML = a.product;
        document.getElementById("stat_vendor").innerHTML = a.vendor;
        document.getElementById("stat_serial").innerHTML = a.serial;
        document.getElementById("stat_sample_rate").innerHTML = a.sample_rate;
        document.getElementById("stat_model").innerHTML = a.model;

        if (a.station_link != "") {
            document.getElementById("stat_station").innerHTML = "<a href='" + a.station_link + "'>" + a.station + "</a>";
        } else {
            document.getElementById("stat_station").innerHTML = a.station;
        }

        var title = document.getElementById("stat_station").textContent;
        if (title != "" && title != null) document.title = "AIS-catcher " + title;

    }

    async function display_plots() {

        const a = await fetch('history_full.json');
        b = await a.json();
        //var h = '{"second":[{"x":0,"y":2},{"x":-1,"y":4},{"x":-2,"y":2},{"x":-3,"y":2},{"x":-4,"y":3},{"x":-5,"y":1},{"x":-6,"y":3},{"x":-7,"y":3},{"x":-8,"y":1},{"x":-9,"y":0},{"x":-10,"y":3},{"x":-11,"y":1},{"x":-12,"y":1},{"x":-13,"y":2},{"x":-14,"y":2},{"x":-15,"y":2},{"x":-16,"y":2},{"x":-17,"y":2},{"x":-18,"y":0},{"x":-19,"y":0},{"x":-20,"y":2},{"x":-21,"y":4},{"x":-22,"y":1},{"x":-23,"y":2},{"x":-24,"y":1},{"x":-25,"y":1},{"x":-26,"y":2},{"x":-27,"y":1},{"x":-28,"y":0},{"x":-29,"y":0},{"x":-30,"y":1},{"x":-31,"y":2},{"x":-32,"y":2},{"x":-33,"y":3},{"x":-34,"y":2},{"x":-35,"y":1},{"x":-36,"y":0},{"x":-37,"y":1},{"x":-38,"y":0},{"x":-39,"y":1},{"x":-40,"y":1},{"x":-41,"y":1},{"x":-42,"y":1},{"x":-43,"y":4},{"x":-44,"y":1},{"x":-45,"y":0},{"x":-46,"y":2},{"x":-47,"y":2},{"x":-48,"y":1},{"x":-49,"y":0},{"x":-50,"y":4},{"x":-51,"y":1},{"x":-52,"y":1},{"x":-53,"y":1},{"x":-54,"y":4},{"x":-55,"y":1},{"x":-56,"y":1},{"x":-57,"y":2},{"x":-58,"y":2},{"x":-59,"y":2},{"x":-60,"y":0},{"x":-61,"y":2},{"x":-62,"y":2},{"x":-63,"y":3},{"x":-64,"y":3},{"x":-65,"y":0},{"x":-66,"y":1},{"x":-67,"y":4},{"x":-68,"y":2},{"x":-69,"y":1},{"x":-70,"y":2},{"x":-71,"y":1},{"x":-72,"y":2},{"x":-73,"y":3},{"x":-74,"y":1},{"x":-75,"y":0},{"x":-76,"y":2},{"x":-77,"y":6},{"x":-78,"y":5},{"x":-79,"y":5},{"x":-80,"y":2},{"x":-81,"y":2},{"x":-82,"y":0},{"x":-83,"y":3},{"x":-84,"y":1},{"x":-85,"y":1},{"x":-86,"y":2},{"x":-87,"y":2},{"x":-88,"y":0},{"x":-89,"y":0},{"x":-90,"y":1},{"x":-91,"y":2},{"x":-92,"y":0},{"x":-93,"y":7},{"x":-94,"y":2},{"x":-95,"y":1},{"x":-96,"y":0},{"x":-97,"y":2},{"x":-98,"y":1},{"x":-99,"y":2},{"x":-100,"y":1},{"x":-101,"y":2},{"x":-102,"y":0},{"x":-103,"y":4},{"x":-104,"y":1},{"x":-105,"y":0},{"x":-106,"y":4},{"x":-107,"y":2},{"x":-108,"y":0},{"x":-109,"y":1},{"x":-110,"y":2},{"x":-111,"y":1},{"x":-112,"y":2},{"x":-113,"y":1},{"x":-114,"y":4},{"x":-115,"y":1},{"x":-116,"y":0},{"x":-117,"y":1},{"x":-118,"y":1},{"x":-119,"y":2},{"x":-120,"y":0},{"x":-121,"y":2},{"x":-122,"y":3},{"x":-123,"y":2},{"x":-124,"y":4},{"x":-125,"y":2},{"x":-126,"y":2},{"x":-127,"y":2},{"x":-128,"y":1},{"x":-129,"y":2},{"x":-130,"y":0},{"x":-131,"y":1},{"x":-132,"y":3},{"x":-133,"y":1},{"x":-134,"y":2},{"x":-135,"y":1},{"x":-136,"y":1},{"x":-137,"y":3},{"x":-138,"y":1},{"x":-139,"y":0},{"x":-140,"y":1},{"x":-141,"y":3},{"x":-142,"y":1},{"x":-143,"y":3},{"x":-144,"y":1},{"x":-145,"y":2},{"x":-146,"y":2},{"x":-147,"y":3},{"x":-148,"y":1},{"x":-149,"y":1},{"x":-150,"y":1},{"x":-151,"y":1},{"x":-152,"y":2},{"x":-153,"y":4},{"x":-154,"y":2},{"x":-155,"y":1},{"x":-156,"y":0},{"x":-157,"y":1},{"x":-158,"y":0},{"x":-159,"y":2},{"x":-160,"y":1},{"x":-161,"y":1},{"x":-162,"y":3},{"x":-163,"y":4},{"x":-164,"y":2},{"x":-165,"y":0},{"x":-166,"y":4},{"x":-167,"y":5},{"x":-168,"y":1},{"x":-169,"y":1},{"x":-170,"y":1},{"x":-171,"y":3},{"x":-172,"y":1},{"x":-173,"y":2},{"x":-174,"y":4},{"x":-175,"y":0},{"x":-176,"y":1},{"x":-177,"y":3},{"x":-178,"y":0},{"x":-179,"y":1}],"minute":[{"x":0,"y":28},{"x":-1,"y":93},{"x":-2,"y":105},{"x":-3,"y":103},{"x":-4,"y":123},{"x":-5,"y":100},{"x":-6,"y":109},{"x":-7,"y":122},{"x":-8,"y":113},{"x":-9,"y":104},{"x":-10,"y":97},{"x":-11,"y":87},{"x":-12,"y":105},{"x":-13,"y":120},{"x":-14,"y":107},{"x":-15,"y":121},{"x":-16,"y":124},{"x":-17,"y":91},{"x":-18,"y":110},{"x":-19,"y":105},{"x":-20,"y":105},{"x":-21,"y":93},{"x":-22,"y":106},{"x":-23,"y":104},{"x":-24,"y":111},{"x":-25,"y":120},{"x":-26,"y":124},{"x":-27,"y":119},{"x":-28,"y":116},{"x":-29,"y":105},{"x":-30,"y":104},{"x":-31,"y":92},{"x":-32,"y":97},{"x":-33,"y":90},{"x":-34,"y":126},{"x":-35,"y":115},{"x":-36,"y":122},{"x":-37,"y":120},{"x":-38,"y":116},{"x":-39,"y":104},{"x":-40,"y":108},{"x":-41,"y":94},{"x":-42,"y":86},{"x":-43,"y":100},{"x":-44,"y":98},{"x":-45,"y":103},{"x":-46,"y":133},{"x":-47,"y":97},{"x":-48,"y":92},{"x":-49,"y":103},{"x":-50,"y":126},{"x":-51,"y":109},{"x":-52,"y":112},{"x":-53,"y":111},{"x":-54,"y":115},{"x":-55,"y":117},{"x":-56,"y":103},{"x":-57,"y":92},{"x":-58,"y":125},{"x":-59,"y":115},{"x":-60,"y":142},{"x":-61,"y":130},{"x":-62,"y":133},{"x":-63,"y":122},{"x":-64,"y":128},{"x":-65,"y":105},{"x":-66,"y":105},{"x":-67,"y":122},{"x":-68,"y":130},{"x":-69,"y":109},{"x":-70,"y":141},{"x":-71,"y":131},{"x":-72,"y":126},{"x":-73,"y":141},{"x":-74,"y":150},{"x":-75,"y":156},{"x":-76,"y":130},{"x":-77,"y":121},{"x":-78,"y":131},{"x":-79,"y":144},{"x":-80,"y":114},{"x":-81,"y":118},{"x":-82,"y":150},{"x":-83,"y":117},{"x":-84,"y":133},{"x":-85,"y":129},{"x":-86,"y":117},{"x":-87,"y":129},{"x":-88,"y":131},{"x":-89,"y":138},{"x":-90,"y":109},{"x":-91,"y":128},{"x":-92,"y":118},{"x":-93,"y":110},{"x":-94,"y":112},{"x":-95,"y":117},{"x":-96,"y":108},{"x":-97,"y":131},{"x":-98,"y":131},{"x":-99,"y":101},{"x":-100,"y":138},{"x":-101,"y":93},{"x":-102,"y":136},{"x":-103,"y":135},{"x":-104,"y":106},{"x":-105,"y":115},{"x":-106,"y":127},{"x":-107,"y":102},{"x":-108,"y":117},{"x":-109,"y":125},{"x":-110,"y":119},{"x":-111,"y":128},{"x":-112,"y":132},{"x":-113,"y":109},{"x":-114,"y":121},{"x":-115,"y":118},{"x":-116,"y":122},{"x":-117,"y":105},{"x":-118,"y":106},{"x":-119,"y":86},{"x":-120,"y":103},{"x":-121,"y":98},{"x":-122,"y":97},{"x":-123,"y":85},{"x":-124,"y":104},{"x":-125,"y":75},{"x":-126,"y":86},{"x":-127,"y":80},{"x":-128,"y":121},{"x":-129,"y":116},{"x":-130,"y":161},{"x":-131,"y":124},{"x":-132,"y":124},{"x":-133,"y":121}],"hour":[{"x":0,"y":28},{"x":-1,"y":6509},{"x":-2,"y":7339},{"x":-3,"y":1392}]}';
        //b = JSON.parse(h);
        if (b.hasOwnProperty('second'))
            chart_seconds.data.datasets[0].data = b.second.count, chart_seconds.update();

        if (b.hasOwnProperty('minute')) {
            chart_minutes.data.datasets[0].data = b.minute.count, chart_minutes.update()
            chart_ppm_minute.data.datasets[0].data = b.minute.ppm, chart_ppm_minute.update()

        }

        if (b.hasOwnProperty('hour'))
            chart_hours.data.datasets[0].data = b.hour.count, chart_hours.update()
        chart_ppm.data.datasets[0].data = b.hour.ppm, chart_ppm.update()
        chart_level.data.datasets[0].data = b.hour.level, chart_level.update()
    }

    function open_map_tab(m) {
        ship_infocus = m;
        document.getElementById('tab-map').click();
    }

    function sort_table(e) {

        if (e.getAttribute('sort-dir') == "asc")
            e.setAttribute('sort-dir', 'dec');
        else
            e.setAttribute('sort-dir', 'asc');

        table_sort = e.getAttribute('field');
        table_dir = e.getAttribute('sort-dir');
        table_type = e.getAttribute('sortable');

        display_shiptable()
    }

    async function display_shiptable() {

        a = await fetch('ships.json');
        ships = await a.json()
        //ships = JSON.parse(ships_json);

        if (popup_visible && popup_ship != null) refresh_popup_content(popup_ship.mmsi)
        var c, b, a, d, e;

        arr = ships.ships.sort(function (a, b) {
            d1 = a[table_sort];
            d2 = b[table_sort];

            if (d1 === d2) return 0;
            if (d1 === null) return 1;
            if (d2 === null) return -1;

            if (table_dir == "asc")
                return d1 < d2 ? -1 : d1 > d2 ? 1 : 0;
            else
                return d1 > d2 ? -1 : d1 < d2 ? 1 : 0;
        });

        c = document.getElementById("shipTableBody"), c.innerHTML = "";

        for (b = 0; b < arr.length; b++) {
            let f = c.insertRow();
            f.setAttribute("mmsi", arr[b].mmsi);
            f.setAttribute("onclick", "toggle_popup_content(" + arr[b].mmsi + ",'" + arr[b].shipname + "','" + arr[b].callsign + "')");

            a = f.insertCell(0), a.innerHTML = arr[b].mmsi;
            a = f.insertCell(1), a.innerHTML = arr[b].shipname;
            a = f.insertCell(2), a.innerHTML = arr[b].callsign


            a = f.insertCell(3), a.innerHTML = deltaTimeToStr(arr[b].last_signal), a.className = "table-aligned-center";
            a = f.insertCell(4), a.innerHTML = arr[b].count, a.className = "table-aligned-center";
            a = f.insertCell(5), a.innerHTML = Number(arr[b].ppm).toFixed(1), a.className = "table-aligned-center";
            a = f.insertCell(6), a.innerHTML = Number(arr[b].level).toFixed(1), a.className = "table-aligned-center";

            if (arr[b].distance != null) {
                a = f.insertCell(7), a.innerHTML = Number(arr[b].distance).toFixed(1);
                a.className = "table-aligned-center";
            } else
                f.insertCell(7).innerHTML = "";

            if (arr[b].lat != null && arr[b].lon != null) {

                a = f.insertCell(8).innerHTML = arr[b].lat != null ? Number(arr[b].lat).toFixed(3) : "";
                a.className = "table-aligned-center";
                a = f.insertCell(9).innerHTML = arr[b].lon != null ? Number(arr[b].lon).toFixed(3) : "";
                a.className = "table-aligned-center";

            } else {
                f.insertCell(8).innerHTML = "";
                f.insertCell(9).innerHTML = "";
            }
        }
    }

    function ship_popup_content(ship, title) {

        var p = "<b>";

        if (title) {

            if (ship.shipname != "") {
                p = p + ship.shipname;
                if (ship.callsign != "") p += " [" + ship.callsign + "]";
            } else p = p + StringFromType(ship);

            p = p + "</b><br>";
            p = p + "MMSI: " + ship.mmsi + "</a><br>";
            if (ship.hasOwnProperty("distance")) p = p + "Distance: " + Number(ship.distance).toFixed(1) + " nmi</br>";
            p = p + "Last Seen: " + deltaTimeToStr(ship.last_signal) + " ago</br>";
            p = p + "Msg Count: " + ship.count + "</br>";
            p = p + "RSSI: " + Number(ship.level).toFixed(2) + "</br>";
            p = p + "Freq Ofs: " + Number(ship.ppm).toFixed(2) + "</br></br>";
        }
        p = p + "External:</br>"
        p = p + "&nbsp;&nbsp;<a href = 'https://www.marinetraffic.com/en/ais/details/ships/" + ship.mmsi + "'>MarineTraffic</a > <br>";
        p = p + "&nbsp;&nbsp;<a href = 'https://www.shipxplorer.com/data/vessels/IMO-MMSI-" + ship.mmsi + "'>ShipXplorer</a > <br>";
        p = p + "&nbsp;&nbsp;<a href = 'https://www.vesselfinder.com/vessels/details/" + ship.mmsi + "'>VesselFinder</a > <br>";
        return p;
    }

    function ship_tooltip_content(ship) {
        if (ship.shipname != "") return "<b>" + ship.shipname + "</b><br>" + deltaTimeToStr(ship.last_signal) + " ago";
        else return "<b> MMSI: " + ship.mmsi + "</b><br>" + deltaTimeToStr(ship.last_signal) + " ago";
    }

    function toggle_popup() {
        document.getElementById("popup_mmsi").classList.toggle("show");
    }

    function popup_visible() {
        return document.getElementById("popup_mmsi").classList.contains(show);
    }

    function refresh_popup_content(x) {
        popup_ship = ships.ships.find(element => element.mmsi == x);

        if (popup_ship == null) {
            return;
        }

        var p = "";
        if (popup_ship.shipname != "") {
            p = popup_ship.shipname;
            if (popup_ship.callsign != "") p += " [" + popup_ship.callsign + "]";
        } else {
            p = p + StringFromType(popup_ship);
        }

        document.getElementById("popup-mmsi").innerHTML = popup_ship.mmsi;
        document.getElementById("popup-type").innerHTML = StringFromType(popup_ship);
        document.getElementById("popup-shipname").innerHTML = popup_ship.shipname;
        document.getElementById("popup-callsign").innerHTML = popup_ship.callsign;
        document.getElementById("popup-last-signal").innerHTML = deltaTimeToStr(popup_ship.last_signal) + " ago</br>";
        document.getElementById("popup-count").innerHTML = popup_ship.count;
        document.getElementById("popup-ppm").innerHTML = Number(popup_ship.ppm).toFixed(1);
        document.getElementById("popup-level").innerHTML = Number(popup_ship.level).toFixed(1) + " dB";

        document.getElementById("popup-speed").innerHTML = popup_ship.speed != null ? Number(popup_ship.speed).toFixed(1) + " kts" : "-";
        document.getElementById("popup-course").innerHTML = popup_ship.cog != null ? Number(popup_ship.cog).toFixed(1) : "-";
        document.getElementById("popup-heading").innerHTML = popup_ship.heading != null ? Number(popup_ship.heading).toFixed(1) : "-";
        document.getElementById("popup-shiptype").innerHTML = StringFromShipType(popup_ship.shiptype);
        document.getElementById("popup-destination").innerHTML = popup_ship.destination;
        document.getElementById("popup-status").innerHTML = StringFromStatus[Math.min(popup_ship.status, 15)];

        if (popup_ship.hasOwnProperty('distance'))
            document.getElementById("popup-distance").innerHTML = popup_ship.distance != null ? Number(popup_ship.distance).toFixed(1) + " nmi" : "-";
        else
            document.getElementById("popup-distance").innerHTML = "";


        document.getElementById("popup_header_text").innerHTML = p;
        document.getElementById("popup_text").innerHTML = ship_popup_content(popup_ship, false);

        if (popup_ship.lat != null && popup_ship.lon != null) {
            document.getElementById("popup-gmaps-icon").onclick = function () {
                toggle_popup();
                window.open("https://www.google.com/maps/search/?api=1&query=" + popup_ship.lat + "," + popup_ship.lon)
            };
            document.getElementById("popup-map-icon").onclick = function () {
                toggle_popup();
                open_map_tab(popup_ship.mmsi);
            };

            document.getElementById("popup-gmaps-icon").visibility = "visible";
            document.getElementById("popup-map-icon").visibility = "visible";
        } else {
            document.getElementById("popup-gmaps-icon").onclick = function () { };
            document.getElementById("popup-map-icon").onclick = function () { };


            document.getElementById("popup-gmaps-icon").visibility = "hidden";
            document.getElementById("popup-map-icon").visibility = "hidden";

        }

    }

    function toggle_popup_content(x) {
        refresh_popup_content(x)
        toggle_popup();
    }

    function StringFromType(ship) {
        switch (ship.mmsi_type) {
            case 1:
                return "Ship (Class A)";
            case 2:
                return "Ship (Class B)";
            case 3:
                return "Base Station";
            case 4:
                return "SAR aircraft"
            case 5:
                return "AIS SART/EPIRB";
            case 6:
                return "Aid-to-Navigation";
        }
        return "Unknown";
    }

    function getIcon(ship) {
        switch (ship.mmsi_type) {
            case 1:
                if (ship.shiptype >= 80 && ship.shiptype < 90) c = 6;
                else c = 0;
                break;
            case 2:
                c = 1;
                break;
            case 3:
                c = 2;
                break;
            case 4:
                c = 4;
                break;
            case 5:
                c = 3;
                break;
            case 6:
                c = 5;
                break;
            default:
                c = 6;
                break;
        }

        if (ship.speed != null && ship.speed > 0.5 && ship.cog != null) {
            cog = ship.cog;
            h = '<DIV CLASS="shipicon" style="background-position: -' + c * 20 + 'px 0; transform: rotate(' + cog + 'deg);"></DIV>';
        } else
            h = '<DIV CLASS="shipicon" style="background-position: -' + c * 20 + 'px -20px;"></DIV>';

        var icon = L.divIcon({
            html: h,
            className: 'temp'
        });
        return icon;
    }

    function plot_ship(ship) {

        var c = "black",
            clr = 'dimgrey',
            o = 1;
        if (ship.shipname != "") o = 1;

        shipIcon = getIcon(ship);

        if (ship.mmsi in markers) {
            markers[ship.mmsi].setIcon(shipIcon);
            markers[ship.mmsi].setLatLng([ship.lat, ship.lon]);
            markers[ship.mmsi].getPopup().setContent(ship_popup_content(ship, true));
            markers[ship.mmsi].getTooltip().setContent(ship_tooltip_content(ship));
        } else {
            markers[ship.mmsi] = L.marker([ship.lat, ship.lon], {
                icon: shipIcon
            }).addTo(map);
            markers[ship.mmsi].bindPopup(ship_popup_content(ship, true));
            markers[ship.mmsi].bindTooltip(ship_tooltip_content(ship), {
                permanent: false,
                direction: 'right'
            });
        }
    }

    async function display_map() {

        a = await fetch('ships.json');
        ships = await a.json()
        //ships = JSON.parse(ships_json);

        if (ships.ships.length == 0)
            return;

        MMSI = new Set();
        for (var i = 0; i < ships.ships.length; i++) {
            if (ships.ships[i].lat != null && ships.ships[i].lon != null && ships.ships[i].lat != 0 && ships.ships[i].lon != 0 && ships.ships[i].lat < 90 && ships.ships[i].lon < 180) {
                if (!map_coord_set) {
                    map.panTo(new L.LatLng(ships.ships[0].lat, ships.ships[0].lon));
                    map_coord_set = true;
                }
                plot_ship(ships.ships[i])
            }
            MMSI.add(ships.ships[i].mmsi);
        }

        for (let [key, m] of Object.entries(markers)) {
            if (!MMSI.has(parseInt(key))) {
                map.removeLayer(m);
                delete markers[parseInt(key)];
            }
        }
        if (ship_infocus in markers) markers[ship_infocus].openPopup();
        ship_infocus = -1;
    }

    function lock_MMSI() {
        lock_mmsi = !lock_mmsi;
        lock_mmsi ? document.getElementById("lockbutton").innerHTML = "MMSI <i class='fa-solid fa-lock' aria - hidden='true' ></i > " : document.getElementById("lockbutton").innerHTML = "MMSI <i class='fa-solid fa-lock-open' aria - hidden='true' ></i > ";

        display_shiptable()
    }


    function refresh_data() {

        if (active_tab == "map") {
            display_map();
            map.invalidateSize();
        } else if (active_tab == "stat") display_stats();
        else if (active_tab == "plots") display_plots();
        else if (active_tab == "shipstab") display_shiptable();
    }

    function select_tab(b, a) {

        tablinks = document.getElementsByClassName("menu-item");

        for (i = 0; i < tablinks.length; i++)
            tablinks[i].className = tablinks[i].className.replace(" active", "");

        tabcontent = document.getElementsByClassName("tabcontent");

        for (i = 0; i < tabcontent.length; i++)
            tabcontent[i].style.display = "none";

        document.getElementById(a).style.display = "block";
        b.currentTarget.className += " active";
        active_tab = a;

        clearInterval(interval);
        refresh_data();
        interval = setInterval(refresh_data, 2500)
    }

    document.getElementById('tab-default').click()
</script>